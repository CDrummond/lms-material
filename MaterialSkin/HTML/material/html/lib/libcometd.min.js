var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(l,u,q){l instanceof String&&(l=String(l));for(var A=l.length,z=0;z<A;z++){var H=l[z];if(u.call(q,H,z,l))return{i:z,v:H}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,u,q){l!=Array.prototype&&l!=Object.prototype&&(l[u]=q.value)};
$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(l,u,q,A){if(u){q=$jscomp.global;l=l.split(".");for(A=0;A<l.length-1;A++){var z=l[A];z in q||(q[z]={});q=q[z]}l=l[l.length-1];A=q[l];u=u(A);u!=A&&null!=u&&$jscomp.defineProperty(q,l,{configurable:!0,writable:!0,value:u})}};
$jscomp.polyfill("Array.prototype.find",function(l){return l?l:function(l,q){return $jscomp.findInternal(this,l,q).v}},"es6","es3");
(function(l,u){"object"===typeof exports?module.exports=u():"function"===typeof define&&define.amd?define([],u):(l.org=l.org||{},l.org.cometd=u())})(this,function(){function l(){var f={};self.onmessage=function(d){var b=d.data;d=f[b.id];switch(b.type){case "setTimeout":f[b.id]=self.setTimeout(function(){delete f[b.id];self.postMessage({id:b.id})},b.delay);break;case "clearTimeout":delete f[b.id];d&&self.clearTimeout(d);break;default:throw"Unknown command "+b.type;}}}var u=function(){var f=0,d={};
this.register=function(b){var c=++f;d[c]=b;return c};this.unregister=function(b){var c=d[b];delete d[b];return c};this.setTimeout=function(b,c){return window.setTimeout(b,c)};this.clearTimeout=function(b){window.clearTimeout(b)}},q={isString:function(f){return void 0===f||null===f?!1:"string"===typeof f||f instanceof String},isArray:function(f){return void 0===f||null===f?!1:f instanceof Array},inArray:function(f,d){for(var b=0;b<d.length;++b)if(f===d[b])return b;return-1}},A=function(){var f=[],
d={};this.getTransportTypes=function(){return f.slice(0)};this.findTransportTypes=function(b,c,k){for(var e=[],m=0;m<f.length;++m){var g=f[m];!0===d[g].accept(b,c,k)&&e.push(g)}return e};this.negotiateTransport=function(b,c,k,e){for(var m=0;m<f.length;++m)for(var g=f[m],C=0;C<b.length;++C)if(g===b[C]){var x=d[g];if(!0===x.accept(c,k,e))return x}return null};this.add=function(b,c,k){for(var e=!1,m=0;m<f.length;++m)if(f[m]===b){e=!0;break}e||("number"!==typeof k?f.push(b):f.splice(k,0,b),d[b]=c);return!e};
this.find=function(b){for(var c=0;c<f.length;++c)if(f[c]===b)return d[b];return null};this.remove=function(b){for(var c=0;c<f.length;++c)if(f[c]===b)return f.splice(c,1),c=d[b],delete d[b],c;return null};this.clear=function(){f=[];d={}};this.reset=function(b){for(var c=0;c<f.length;++c)d[f[c]].reset(b)}},z=function(){var f,d,b;this.registered=function(c,b){f=c;d=b};this.unregistered=function(){d=f=null};this._debug=function(){d._debug.apply(d,arguments)};this._mixin=function(){return d._mixin.apply(d,
arguments)};this.getConfiguration=function(){return d.getConfiguration()};this.getAdvice=function(){return d.getAdvice()};this.setTimeout=function(c,b){return d.setTimeout(c,b)};this.clearTimeout=function(c){d.clearTimeout(c)};this.convertToMessages=function(c){if(q.isString(c))try{return JSON.parse(c)}catch(k){throw this._debug("Could not convert to JSON the following string",'"'+c+'"'),k;}if(q.isArray(c))return c;if(void 0===c||null===c)return[];if(c instanceof Object)return[c];throw"Conversion Error "+
c+", typeof "+typeof c;};this.accept=function(c,b,e){throw"Abstract";};this.getType=function(){return f};this.getURL=function(){return b};this.setURL=function(c){b=c};this.send=function(c,b){throw"Abstract";};this.reset=function(c){this._debug("Transport",f,"reset",c?"initial":"retry")};this.abort=function(){this._debug("Transport",f,"aborted")};this.toString=function(){return this.getType()}};z.derive=function(f){function d(){}d.prototype=f;return new d};var H=function(){function f(c){for(;0<x.length;){var b=
x[0],e=b[0];b=b[1];if(e.url===c.url&&e.sync===c.sync)x.shift(),c.messages=c.messages.concat(e.messages),this._debug("Coalesced",e.messages.length,"messages from request",b.id);else break}}function d(c,b){this.transportSend(c,b);b.expired=!1;if(!c.sync){var e=this.getConfiguration().maxNetworkDelay,d=e;!0===b.metaConnect&&(d+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",e);var f=this;b.timeout=this.setTimeout(function(){b.expired=
!0;var t="Request "+b.id+" of transport "+f.getType()+" exceeded "+d+" ms max network delay",e={reason:t},p=b.xhr;e.httpCode=f.xhrStatus(p);f.abortXHR(p);f._debug(t);f.complete(b,!1,b.metaConnect);c.onFailure(p,c.messages,e)},d)}}function b(b){var c=++m,e={id:c,metaConnect:!1,envelope:b};C.length<this.getConfiguration().maxConnections-1?(C.push(e),d.call(this,b,e)):(this._debug("Transport",this.getType(),"queueing request",c,"envelope",b),x.push([b,e]))}function c(c,e){var d=q.inArray(c,C);0<=d&&
C.splice(d,1);if(0<x.length){d=x.shift();var k=d[0],p=d[1];this._debug("Transport dequeued request",p.id);if(e)this.getConfiguration().autoBatch&&f.call(this,k),b.call(this,k),this._debug("Transport completed request",c.id,k);else{var t=this;this.setTimeout(function(){t.complete(p,!1,p.metaConnect);var b={reason:"Previous request failed"},c=p.xhr;b.httpCode=t.xhrStatus(c);k.onFailure(c,k.messages,b)},0)}}}var k=new z,e=z.derive(k),m=0,g=null,C=[],x=[];e.complete=function(b,e,d){if(d){b=b.id;this._debug("Transport",
this.getType(),"/meta/connect complete, request",b);if(null!==g&&g.id!==b)throw"/meta/connect request mismatch, completing request "+b;g=null}else c.call(this,b,e)};e.transportSend=function(b,c){throw"Abstract";};e.transportSuccess=function(b,c,e){if(!c.expired)if(this.clearTimeout(c.timeout),this.complete(c,!0,c.metaConnect),e&&0<e.length)b.onSuccess(e);else b.onFailure(c.xhr,b.messages,{httpCode:204})};e.transportFailure=function(b,c,e){c.expired||(this.clearTimeout(c.timeout),this.complete(c,!1,
c.metaConnect),b.onFailure(c.xhr,b.messages,e))};e.send=function(c,e){if(e){if(null!==g)throw"Concurrent /meta/connect requests not allowed, request id="+g.id+" not yet completed";e=++m;this._debug("Transport",this.getType(),"/meta/connect send, request",e,"envelope",c);e={id:e,metaConnect:!0,envelope:c};d.call(this,c,e);g=e}else b.call(this,c)};e.abort=function(){k.abort();for(var c=0;c<C.length;++c){var b=C[c];b&&(this._debug("Aborting request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,
b,{reason:"abort"}))}if(c=g)this._debug("Aborting /meta/connect request",c),this.abortXHR(c.xhr)||this.transportFailure(c.envelope,c,{reason:"abort"});this.reset(!0)};e.reset=function(c){k.reset(c);g=null;C=[];x=[]};e.abortXHR=function(c){if(c)try{var b=c.readyState;c.abort();return b!==window.XMLHttpRequest.UNSENT}catch(Ga){this._debug(Ga)}return!1};e.xhrStatus=function(c){if(c)try{return c.status}catch(r){this._debug(r)}return-1};return e},oa=function(){var f=new H,d=z.derive(f),b=!0;d.accept=function(c,
d,e){return b||!d};d.newXMLHttpRequest=function(){return new window.XMLHttpRequest};d.xhrSend=function(c){var b=d.newXMLHttpRequest();b.context=d.context;b.withCredentials=!0;b.open("POST",c.url,!0!==c.sync);var e=c.headers;if(e)for(var f in e)e.hasOwnProperty(f)&&b.setRequestHeader(f,e[f]);b.setRequestHeader("Content-Type","application/json;charset=UTF-8");b.onload=function(){if(200===b.status)c.onSuccess(b.responseText);else c.onError(b.statusText)};b.onerror=function(){c.onError(b.statusText)};
b.send(c.body);return b};d.transportSend=function(c,d){this._debug("Transport",this.getType(),"sending request",d.id,"envelope",c);var e=this;try{var f=!0;d.xhr=this.xhrSend({transport:this,url:c.url,sync:c.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(c.messages),onSuccess:function(f){e._debug("Transport",e.getType(),"received response",f);var g=!1;try{var k=e.convertToMessages(f);0===k.length?(b=!1,e.transportFailure(c,d,{httpCode:204})):(g=!0,e.transportSuccess(c,d,k))}catch(p){e._debug(p),
g||(b=!1,f={exception:p},f.httpCode=e.xhrStatus(d.xhr),e.transportFailure(c,d,f))}},onError:function(g,k){e._debug("Transport",e.getType(),"received error",g,k);b=!1;var m={reason:g,exception:k};m.httpCode=e.xhrStatus(d.xhr);f?e.setTimeout(function(){e.transportFailure(c,d,m)},0):e.transportFailure(c,d,m)}});f=!1}catch(g){b=!1,this.setTimeout(function(){e.transportFailure(c,d,{exception:g})},0)}};d.reset=function(c){f.reset(c);b=!0};return d},pa=function(){function f(b,d,e){var c=this;return function(){c.transportFailure(b,
d,"error",e)}}var d=new H;d=z.derive(d);var b=0;d.accept=function(b,d,e){return!0};d.jsonpSend=function(c){var d=document.getElementsByTagName("head")[0],e=document.createElement("script"),f="_cometd_jsonp_"+b++;window[f]=function(b){d.removeChild(e);delete window[f];c.onSuccess(b)};var g=c.url;g+=0>g.indexOf("?")?"?":"&";g=g+("jsonp="+f)+("&message="+encodeURIComponent(c.body));e.src=g;e.async=!0!==c.sync;e.type="application/javascript";e.onerror=function(b){c.onError("jsonp "+b.type)};d.appendChild(e)};
d.transportSend=function(b,d){for(var c=this,m=0,g=b.messages.length,k=[];0<g;){var l=JSON.stringify(b.messages.slice(m,m+g));l=b.url.length+encodeURI(l).length;var p=this.getConfiguration().maxURILength;if(l>p){if(1===g){k="Bayeux message too big ("+l+" bytes, max is "+p+") for transport "+this.getType();this.setTimeout(f.call(this,b,d,k),0);return}--g}else k.push(g),m+=g,g=b.messages.length-m}var r=b;if(1<k.length)for(m=0,g=k[0],this._debug("Transport",this.getType(),"split",b.messages.length,"messages into",
k.join(" + ")),r=this._mixin(!1,{},b),r.messages=b.messages.slice(m,g),r.onSuccess=b.onSuccess,r.onFailure=b.onFailure,l=1;l<k.length;++l)p=this._mixin(!1,{},b),m=g,g+=k[l],p.messages=b.messages.slice(m,g),p.onSuccess=b.onSuccess,p.onFailure=b.onFailure,this.send(p,d.metaConnect);this._debug("Transport",this.getType(),"sending request",d.id,"envelope",r);try{var q=!0;this.jsonpSend({transport:this,url:r.url,sync:r.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(r.messages),
onSuccess:function(b){var e=!1;try{var f=c.convertToMessages(b);0===f.length?c.transportFailure(r,d,{httpCode:204}):(e=!0,c.transportSuccess(r,d,f))}catch(L){c._debug(L),e||c.transportFailure(r,d,{exception:L})}},onError:function(b,e){var f={reason:b,exception:e};q?c.setTimeout(function(){c.transportFailure(r,d,f)},0):c.transportFailure(r,d,f)}});q=!1}catch(Ha){this.setTimeout(function(){c.transportFailure(r,d,{exception:Ha})},0)}};return d},sa=function(){function f(b,c){b&&(this.webSocketClose(b,
c.code,c.reason),this.onClose(b,c))}function d(b,c,d){for(var e=[],f=0;f<c.messages.length;++f){var t=c.messages[f];t.id&&e.push(t.id)}b.envelopes[e.join(",")]=[c,d];this._debug("Transport",this.getType(),"stored envelope, envelopes",b.envelopes)}function b(b){if(!u){var c=g.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",c);try{var d=g.getConfiguration().protocol;b.webSocket=d?new window.WebSocket(c,d):new window.WebSocket(c);u=b}catch(M){throw l=!1,this._debug("Exception while creating WebSocket object",
M),M;}p=!1!==g.getConfiguration().stickyReconnect;var e=this,t=g.getConfiguration().connectTimeout;0<t&&(b.connectTimer=this.setTimeout(function(){g._debug("Transport",e.getType(),"timed out while connecting to URL",c,":",t,"ms");f.call(e,b,{code:1E3,reason:"Connect Timeout"})},t));var k=function(c){c=c||{code:1E3};g._debug("WebSocket onclose",b,c,"connecting",u,"current",r);b.connectTimer&&e.clearTimeout(b.connectTimer);e.onClose(b,c)};b.webSocket.onopen=function(){g._debug("WebSocket onopen",b);
b.connectTimer&&e.clearTimeout(b.connectTimer);b===u||b===r?(u=null,r=b,x=!0,e.onOpen(b)):(g._warn("Closing extra WebSocket connection",this,"active connection",r),f.call(e,b,{code:1E3,reason:"Extra Connection"}))};b.webSocket.onclose=k;b.webSocket.onerror=function(){k({code:1E3,reason:"Error"})};b.webSocket.onmessage=function(c){g._debug("WebSocket onmessage",c,b);e.onMessage(b,c)};this._debug("Transport",this.getType(),"configured callbacks on",b)}}function c(b,c,d){var e=JSON.stringify(c.messages);
b.webSocket.send(e);this._debug("Transport",this.getType(),"sent",c,"/meta/connect =",d);var t=e=this.getConfiguration().maxNetworkDelay;d&&(t+=this.getAdvice().timeout,A=!0);for(var k=this,l=[],m=0;m<c.messages.length;++m)(function(){var d=c.messages[m];d.id&&(l.push(d.id),b.timeouts[d.id]=k.setTimeout(function(){g._debug("Transport",k.getType(),"timing out message",d.id,"after",t,"on",b);f.call(k,b,{code:1E3,reason:"Message Timeout"})},t))})();this._debug("Transport",this.getType(),"waiting at most",
t,"ms for messages",l,"maxNetworkDelay",e,", timeouts:",b.timeouts)}function k(e,g,k){try{null===e?(e=u||{envelopes:{},timeouts:{}},d.call(this,e,g,k),b.call(this,e)):(d.call(this,e,g,k),c.call(this,e,g,k))}catch(S){var t=this;this.setTimeout(function(){f.call(t,e,{code:1E3,reason:"Exception",exception:S})},0)}}var e=new z,m=z.derive(e),g,l=!0,x=!1,p=!0,r=null,u=null,A=!1,y=null;m.reset=function(b){e.reset(b);l=!0;b&&(x=!1);p=!0;u=r=null;A=!1};m._notifySuccess=function(b,c){b.call(this,c)};m._notifyFailure=
function(b,c,d,e){b.call(this,c,d,e)};m.onOpen=function(b){var d=b.envelopes;this._debug("Transport",this.getType(),"opened",b,"pending messages",d);for(var e in d)if(d.hasOwnProperty(e)){var f=d[e],g=f[0];f=f[1];y=g.onSuccess;c.call(this,b,g,f)}};m.onMessage=function(b,c){this._debug("Transport",this.getType(),"received websocket message",c,b);var d=!1;c=this.convertToMessages(c.data);for(var e=[],f=0;f<c.length;++f){var g=c[f];if((/^\/meta\//.test(g.channel)||void 0===g.data)&&g.id){e.push(g.id);
var k=b.timeouts[g.id];k&&(this.clearTimeout(k),delete b.timeouts[g.id],this._debug("Transport",this.getType(),"removed timeout for message",g.id,", timeouts",b.timeouts))}"/meta/connect"===g.channel&&(A=!1);"/meta/disconnect"!==g.channel||A||(d=!0)}f=!1;g=b.envelopes;for(k=0;k<e.length;++k){var l=e[k],m;for(m in g)if(g.hasOwnProperty(m)){var t=m.split(","),p=q.inArray(l,t);if(0<=p){f=!0;t.splice(p,1);l=g[m][0];p=g[m][1];delete g[m];0<t.length&&(g[t.join(",")]=[l,p]);break}}}f&&this._debug("Transport",
this.getType(),"removed envelope, envelopes",g);this._notifySuccess(y,c);d&&this.webSocketClose(b,1E3,"Disconnect")};m.onClose=function(b,c){this._debug("Transport",this.getType(),"closed",b,c);if(b===u||b===r)l=p&&x,r=u=null;var d=b.timeouts;b.timeouts={};for(var e in d)d.hasOwnProperty(e)&&this.clearTimeout(d[e]);d=b.envelopes;b.envelopes={};for(var f in d)if(d.hasOwnProperty(f)){e=d[f][0];d[f][1]&&(A=!1);var g={websocketCode:c.code,reason:c.reason};c.exception&&(g.exception=c.exception);this._notifyFailure(e.onFailure,
b,e.messages,g)}};m.registered=function(b,c){e.registered(b,c);g=c};m.accept=function(b,c,d){this._debug("Transport",this.getType(),"accept, supported:",l);return l&&!!window.WebSocket&&!1!==g.websocketEnabled};m.send=function(b,c){this._debug("Transport",this.getType(),"sending",b,"/meta/connect =",c);k.call(this,r,b,c)};m.webSocketClose=function(b,c,d){try{b.webSocket&&b.webSocket.close(c,d)}catch(ba){this._debug(ba)}};m.abort=function(){e.abort();f.call(this,r,{code:1E3,reason:"Abort"});this.reset(!0)};
return m},T="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),ha=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(f){function d(a,b){try{return a[b]}catch(B){}}function b(a){return void 0===a||null===a?!1:"function"===
typeof a}function c(a,b){for(var c="";0<--b&&!(a>=Math.pow(10,b));)c+="0";return c+a}function k(a,n){if(window.console&&(a=window.console[a],b(a))){var d=new Date;[].splice.call(n,0,0,c(d.getHours(),2)+":"+c(d.getMinutes(),2)+":"+c(d.getSeconds(),2)+"."+c(d.getMilliseconds(),3));a.apply(window.console,n)}}function e(a){return/(^https?:\/\/)?(((\[[^\]]+])|([^:/?#]+))(:(\d+))?)?([^?#]*)(.*)?/.exec(a)}function m(a){h._debug("Configuring cometd object with",a);q.isString(a)&&(a={url:a});a||(a={});w=h._mixin(!1,
w,a);a=h.getURL();if(!a)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=e(a);a=b[8];var c=b[9];ca=h._isCrossDomain(b[2]);w.appendMessageTypeToURL&&(void 0!==c&&0<c.length?(h._info("Appending message type to URI "+a+c+" is not supported, disabling 'appendMessageTypeToURL' configuration"),w.appendMessageTypeToURL=!1):(b=a.split("/"),c=b.length-1,a.match(/\/$/)&&--c,0<=b[c].indexOf(".")&&(h._info("Appending message type to URI "+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),
w.appendMessageTypeToURL=!1)));if(window.Worker&&window.Blob&&window.URL&&w.useWorkerScheduler){a=l.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));a=new window.Blob([a],{type:"application/json"});a=window.URL.createObjectURL(a);var d=new window.Worker(a);O.setTimeout=function(a,b){a=O.register(a);d.postMessage({id:a,type:"setTimeout",delay:b});return a};O.clearTimeout=function(a){O.unregister(a);d.postMessage({id:a,type:"clearTimeout"})};d.onmessage=function(a){(a=O.unregister(a.data.id))&&
a()}}}function g(a){if(a){var b=I[a.channel];b&&b[a.id]&&(delete b[a.id],h._debug("Removed",a.listener?"listener":"subscription",a))}}function C(){for(var a in I)if(I.hasOwnProperty(a)){var b=I[a];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&g(d)}}}function x(a){N!==a&&(h._debug("Status",N,"->",a),N=a)}function p(){return"disconnecting"===N||"disconnected"===N}function r(a,c,d,e,f){try{return c.call(a,e)}catch(P){a=h.onExtensionException;if(b(a)){h._debug("Invoking extension exception handler",
d,P);try{a.call(h,P,d,f,e)}catch(ia){h._info("Exception during execution of extension exception handler",d,ia)}}else h._info("Exception during execution of extension",d,P);return e}}function z(a){for(var c=E.length-1;0<=c&&void 0!==a&&null!==a;--c){var d=E[c],e=d.extension.outgoing;b(e)&&(d=r(d.extension,e,d.name,a,!0),a=void 0===d?a:d)}return a}function H(a,c){if(a=I[a])for(var d in a)if(a.hasOwnProperty(d)){var n=a[d];if(n)try{n.callback.call(n.scope,c)}catch(P){var e=h.onListenerException;if(b(e)){h._debug("Invoking listener exception handler",
n,P);try{e.call(h,P,n,n.listener,c)}catch(ia){h._info("Exception during execution of listener exception handler",n,ia)}}else h._info("Exception during execution of listener",n,c,P)}}}function y(a,b){H(a,b);a=a.split("/");for(var c=a.length-1,n=c;0<n;--n){var d=a.slice(0,n).join("/")+"/*";n===c&&H(d,b);d+="*";H(d,b)}}function t(a,b){null!==Q&&h.clearTimeout(Q);Q=null;b=D.interval+b;h._debug("Function scheduled in",b,"ms, interval =",D.interval,"backoff =",F,a);Q=h.setTimeout(a,b)}function L(a,b,c){for(var d=
0;d<a.length;++d){var n=a[d],e=n.id;U&&(n.clientId=U);n=z(n);void 0!==n&&null!==n?(n.id=e,a[d]=n):(delete da[e],a.splice(d--,1))}0!==a.length&&(b&&(Y=a[0]),d=h.getURL(),w.appendMessageTypeToURL&&(d.match(/\/$/)||(d+="/"),c&&(d+=c)),a={url:d,sync:!1,messages:a,onSuccess:function(a){try{Ka.call(h,a)}catch(La){h._info("Exception during handling of messages",La)}},onFailure:function(a,b,c){try{var d=h.getTransport();c.connectionType=d?d.getType():"unknown";ta.call(h,a,b,c)}catch(Ma){h._info("Exception during handling of failure",
Ma)}}},h._debug("Send",a),v.send(a,b))}function X(a){0<K||!0===Z?V.push(a):L([a],!1)}function ba(){var a=V;V=[];0<a.length&&L(a,!1)}function S(a){x("connecting");t(function(){if(!p()){var a={id:""+ ++R,channel:"/meta/connect",connectionType:v.getType()};ea||(a.advice={timeout:0});x("connecting");h._debug("Connect sent",a);L([a],!0,"connect");x("connected")}},a)}function T(a){a&&(D=h._mixin(!1,{},w.advice,a),h._debug("New advice",D))}function M(a){null!==Q&&h.clearTimeout(Q);Q=null;a&&v&&v.abort();
ca=!1;v=null;x("disconnected");U=null;F=K=0;ea=ja=!1;aa=0;Y=null;0<V.length&&(a=V,V=[],ta.call(h,void 0,a,{reason:"Disconnected"}))}function fa(a,c,d){var n=h.onTransportException;if(b(n)){h._debug("Invoking transport exception handler",a,c,d);try{n.call(h,d,a,c)}catch(Ja){h._info("Exception during execution of transport exception handler",Ja)}}}function qa(a,c){b(a)&&(c=a,a=void 0);U=null;C();p()&&G.reset(!0);T({});K=0;Z=!0;ka=a;ua=c;a=h.getURL();var d=G.findTransportTypes("1.0",ca,a),n={id:""+ ++R,
version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:d,advice:{timeout:D.timeout,interval:D.interval}};n=h._mixin(!1,{},ka,n);h._putCallback(n.id,c);if(!v&&(v=G.negotiateTransport(d,"1.0",ca,a),!v))throw c="Could not find initial transport among: "+G.getTransportTypes(),h._warn(c),c;h._debug("Initial transport is",v.getType());x("handshaking");h._debug("Handshake sent",n);L([n],!1,"handshake")}function ha(a){x("handshaking");Z=!0;t(function(){qa(ka,ua)},a)}function ra(a,
c){try{a.call(h,c)}catch(B){if(a=h.onCallbackException,b(a)){h._debug("Invoking callback exception handler",B);try{a.call(h,B,c)}catch(Ia){h._info("Exception during execution of callback exception handler",Ia)}}else h._info("Exception during execution of message callback",B)}}function J(a){var c=h._getCallback([a.id]);b(c)&&(delete da[a.id],ra(c,a))}function va(a){var c=la[a.id];delete la[a.id];if(c){h._debug("Handling remote call response for",a,"with context",c);var d=c.timeout;d&&h.clearTimeout(d);
c=c.callback;if(b(c))return ra(c,a),!0}return!1}function wa(a){h._debug("Transport failure handling",a);a.transport&&(v=a.transport);a.url&&v.setURL(a.url);var b=a.action;a=a.delay||0;switch(b){case "handshake":ha(a);break;case "retry":S(a);break;case "none":M(!0);break;default:throw"Unknown action "+b;}}function ma(a,b){J(a);y("/meta/handshake",a);y("/meta/unsuccessful",a);p()&&(b.action="none");h.onTransportFailure.call(h,a,b,wa)}function xa(a){return"disconnected"===N?!0:Y&&Y.id===a.id?(Y=null,
!0):!1}function ya(a,b){y("/meta/connect",a);y("/meta/unsuccessful",a);p()&&(b.action="none");h.onTransportFailure.call(h,a,b,wa)}function za(a){M(!0);J(a);y("/meta/disconnect",a);y("/meta/unsuccessful",a)}function Aa(a){var b=I[a.subscription];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&(delete b[c],h._debug("Removed failed subscription",d))}J(a);y("/meta/subscribe",a);y("/meta/unsuccessful",a)}function Ba(a){J(a);y("/meta/unsubscribe",a);y("/meta/unsuccessful",a)}function na(a){va(a)||
(J(a),y("/meta/publish",a),y("/meta/unsuccessful",a))}function Ca(a){for(var c=aa=0;c<E.length&&void 0!==a&&null!==a;++c){var d=E[c],f=d.extension.incoming;b(f)&&(d=r(d.extension,f,d.name,a,!1),a=void 0===d?a:d)}if(void 0!==a&&null!==a)switch(T(a.advice),a.channel){case "/meta/handshake":c=h.getURL();if(a.successful)if(d=h._isCrossDomain(e(c)[2]),c=G.negotiateTransport(a.supportedConnectionTypes,a.version,d,c),null===c)a.successful=!1,ma(a,{cause:"negotiation",action:"none",transport:null});else switch(v!==
c&&(h._debug("Transport",v.getType(),"->",c.getType()),v=c),U=a.clientId,Z=!1,ba(),a.reestablish=ja,ja=!0,J(a),y("/meta/handshake",a),W=a["x-messages"]||0,a=p()?"none":D.reconnect||"retry",a){case "retry":F=0;0===W?S(0):h._debug("Processing",W,"handshake-delivered messages");break;case "none":M(!0);break;default:throw"Unrecognized advice action "+a;}else ma(a,{cause:"unsuccessful",action:D.reconnect||"handshake",transport:v});break;case "/meta/connect":if(xa(a))if(ea=a.successful)switch(y("/meta/connect",
a),a=p()?"none":D.reconnect||"retry",a){case "retry":F=0;S(F);break;case "none":M(!1);break;default:throw"Unrecognized advice action "+a;}else ya(a,{cause:"unsuccessful",action:D.reconnect||"retry",transport:v});else h._debug("Mismatched /meta/connect reply",a);break;case "/meta/disconnect":a.successful?(M(!1),J(a),y("/meta/disconnect",a)):za(a);break;case "/meta/subscribe":a.successful?(J(a),y("/meta/subscribe",a)):Aa(a);break;case "/meta/unsubscribe":a.successful?(J(a),y("/meta/unsubscribe",a)):
Ba(a);break;default:void 0!==a.data?va(a)||(y(a.channel,a),0<W&&(--W,0===W&&(h._debug("Processed last handshake-delivered message"),S(0)))):void 0===a.successful?h._warn("Unknown Bayeux Message",a):a.successful?(J(a),y("/meta/publish",a)):na(a)}}function Da(a){if(a=I[a])for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!0;return!1}function Ea(a,c){var d={scope:a,method:c};if(b(a))d.scope=void 0,d.method=a;else if(q.isString(c)){if(!a)throw"Invalid scope "+a;d.method=a[c];if(!b(d.method))throw"Invalid callback "+
c+" for scope "+a;}else if(!b(c))throw"Invalid callback "+c;return d}function Fa(a,b,c,d){c=Ea(b,c);h._debug("Adding",d?"listener":"subscription","on",a,"with scope",c.scope,"and callback",c.method);b=++Na;c={id:b,channel:a,scope:c.scope,callback:c.method,listener:d};var e=I[a];e||(e={},I[a]=e);e[b]=c;h._debug("Added",d?"listener":"subscription",c);return c}var O=new u,h=this,Oa=f||"default",ca=!1,G=new A,v,N="disconnected",R=0,U=null,K=0,V=[],Z=!1,Na=0,I={},F=0,Q=null,E=[],D={},ka,ua,da={},la={},
ja=!1,ea=!1,aa=0,W=0,Y=null,w={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2E3,advice:{timeout:6E4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(a,b,c){for(var e=b||{},f=2;f<arguments.length;++f){var n=arguments[f];if(void 0!==n&&null!==n)for(var g in n)if(n.hasOwnProperty(g)){var h=d(n,
g),B=d(e,g);h!==b&&void 0!==h&&(e[g]=a&&"object"===typeof h&&null!==h?h instanceof Array?this._mixin(a,B instanceof Array?B:[],h):this._mixin(a,"object"!==typeof B||B instanceof Array?{}:B,h):h)}}return e};this._warn=function(){k("warn",arguments)};this._info=function(){"warn"!==w.logLevel&&k("info",arguments)};this._debug=function(){"debug"===w.logLevel&&k("debug",arguments)};this._isCrossDomain=function(a){return window.location&&window.location.host&&a?a!==window.location.host:!1};this.send=X;
this._getCallback=function(a){return da[a]};this._putCallback=function(a,c){var d=this._getCallback(a);b(c)&&(da[a]=c);return d};this.onTransportFailure=function(a,b,c){this._debug("Transport failure",b,"for",a);var d=this.getTransportRegistry(),f=this.getURL(),n=this._isCrossDomain(e(f)[2]),g=d.findTransportTypes("1.0",n,f);"none"===b.action?"/meta/handshake"!==a.channel||b.transport||(d="Could not negotiate transport, client=["+g+"], server=["+a.supportedConnectionTypes+"]",this._warn(d),fa(v.getType(),
null,{reason:d,connectionType:v.getType(),transport:v})):(b.delay=this.getBackoffPeriod(),"/meta/handshake"===a.channel?(b.transport||((d=d.negotiateTransport(g,"1.0",n,f))?(this._debug("Transport",v.getType(),"->",d.getType()),fa(v.getType(),d.getType(),a.failure),b.action="handshake",b.transport=d):(this._warn("Could not negotiate transport, client=["+g+"]"),fa(v.getType(),null,a.failure),b.action="none")),"none"!==b.action&&this.increaseBackoffPeriod()):(a=(new Date).getTime(),0===aa&&(aa=a),"retry"===
b.action&&(b.delay=this.increaseBackoffPeriod(),g=D.maxInterval,0<g&&a-aa+F>D.timeout+D.interval+g&&(b.action="handshake")),"handshake"===b.action&&(b.delay=0,d.reset(!1),this.resetBackoffPeriod())));c.call(h,b)};this.receive=Ca;var Ka=function(a){h._debug("Received",a);for(var b=0;b<a.length;++b)Ca(a[b])};var ta=function(a,b,c){h._debug("handleFailure",a,b,c);c.transport=a;for(a=0;a<b.length;++a){var d=b[a],e={id:d.id,successful:!1,channel:d.channel,failure:c};c.message=d;switch(d.channel){case "/meta/handshake":ma(e,
{cause:"failure",action:"handshake",transport:null});break;case "/meta/connect":d=e;xa(d)?(ea=!1,ya(d,{cause:"failure",action:"retry",transport:null})):h._debug("Mismatched /meta/connect failure",d);break;case "/meta/disconnect":za(e);break;case "/meta/subscribe":e.subscription=d.subscription;Aa(e);break;case "/meta/unsubscribe":e.subscription=d.subscription;Ba(e);break;default:na(e)}}};this.registerTransport=function(a,c,d){if(d=G.add(a,c,d))this._debug("Registered transport",a),b(c.registered)&&
c.registered(a,this);return d};this.unregisterTransport=function(a){var c=G.remove(a);null!==c&&(this._debug("Unregistered transport",a),b(c.unregistered)&&c.unregistered());return c};this.unregisterTransports=function(){G.clear()};this.getTransportTypes=function(){return G.getTransportTypes()};this.findTransport=function(a){return G.find(a)};this.getTransportRegistry=function(){return G};this.configure=function(a){m.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=
function(a,b){if("disconnected"!==N)throw"Illegal state: handshaken";qa(a,b)};this.disconnect=function(a,c){if(!p()){b(a)&&(c=a,a=void 0);var d={id:""+ ++R,channel:"/meta/disconnect"};a=this._mixin(!1,{},a,d);h._putCallback(a.id,c);x("disconnecting");L([a],!1,"disconnect")}};this.startBatch=function(){++K;h._debug("Starting batch, depth",K)};this.endBatch=function(){--K;h._debug("Ending batch, depth",K);if(0>K)throw"Calls to startBatch() and endBatch() are not paired";0!==K||p()||Z||ba()};this.batch=
function(a,b){a=Ea(a,b);this.startBatch();try{a.method.call(a.scope),this.endBatch()}catch(B){throw this._info("Exception during execution of batch",B),this.endBatch(),B;}};this.addListener=function(a,b,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";return Fa(a,b,c,!0)};this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+
a;g(a)};this.clearListeners=function(){I={}};this.subscribe=function(a,c,d,e,f){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(p())throw"Illegal state: disconnected";b(c)&&(f=e,e=d,d=c,c=void 0);b(e)&&(f=e,e=void 0);var g=!Da(a),n=Fa(a,c,d,!1);g&&(g={id:""+ ++R,channel:"/meta/subscribe",subscription:a},g=this._mixin(!1,{},e,g),h._putCallback(g.id,f),X(g));return n};this.unsubscribe=
function(a,c,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(p())throw"Illegal state: disconnected";b(c)&&(d=c,c=void 0);this.removeListener(a);var e=a.channel;Da(e)||(e={id:""+ ++R,channel:"/meta/unsubscribe",subscription:e},e=this._mixin(!1,{},c,e),h._putCallback(e.id,d),X(e))};this.resubscribe=function(a,b){a&&!a.listener&&g(a);if(a)return this.subscribe(a.channel,a.scope,a.callback,b)};this.clearSubscriptions=function(){C()};this.publish=function(a,
c,d,e){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(p())throw"Illegal state: disconnected";b(c)?(e=c,c={},d=void 0):b(d)&&(e=d,d=void 0);var f={id:""+ ++R,channel:a,data:c};f=this._mixin(!1,{},d,f);h._putCallback(f.id,e);X(f)};this.publishBinary=function(a,c,d,e,f){b(c)?(f=c,c=new ArrayBuffer(0),d=!0,
e=void 0):b(d)?(f=d,d=!0,e=void 0):b(e)&&(f=e,e=void 0);this.publish(a,{meta:e,data:c,last:d},{ext:{binary:{}}},f)};this.remoteCall=function(a,c,d,e,f){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: target must be a string";if(p())throw"Illegal state: disconnected";b(c)?(f=c,c={},d=w.maxNetworkDelay,e=void 0):b(d)?(f=d,d=w.maxNetworkDelay,e=void 0):b(e)&&(f=e,e=void 0);if("number"!==typeof d)throw"Illegal argument type: timeout must be a number";
a.match(/^\//)||(a="/"+a);var g={id:""+ ++R,channel:"/service"+a,data:c},k=this._mixin(!1,{},e,g);g={callback:f};0<d&&(g.timeout=h.setTimeout(function(){h._debug("Timing out remote call",k,"after",d,"ms");na({id:k.id,error:"406::timeout",successful:!1,failure:{message:k,reason:"Remote Call Timeout"}})},d),h._debug("Scheduled remote call timeout",k,"in",d,"ms"));la[k.id]=g;X(k)};this.remoteCallBinary=function(a,c,d,e,f,g){b(c)?(g=c,c=new ArrayBuffer(0),d=!0,e=void 0,f=w.maxNetworkDelay):b(d)?(g=d,
d=!0,e=void 0,f=w.maxNetworkDelay):b(e)?(g=e,e=void 0,f=w.maxNetworkDelay):b(f)&&(g=f,f=w.maxNetworkDelay);this.remoteCall(a,{meta:e,data:c,last:d},f,{ext:{binary:{}}},g)};this.getStatus=function(){return N};this.isDisconnected=p;this.setBackoffIncrement=function(a){w.backoffIncrement=a};this.getBackoffIncrement=function(){return w.backoffIncrement};this.getBackoffPeriod=function(){return F};this.increaseBackoffPeriod=function(){F<w.maxBackoff&&(F+=w.backoffIncrement);return F};this.resetBackoffPeriod=
function(){F=0};this.setLogLevel=function(a){w.logLevel=a};this.registerExtension=function(a,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var d=!1,e=0;e<E.length;++e)if(E[e].name===a){d=!0;break}if(d)return this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1;E.push({name:a,extension:c});this._debug("Registered extension",
a);b(c.registered)&&c.registered(a,this);return!0};this.unregisterExtension=function(a){if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<E.length;++d){var e=E[d];if(e.name===a){E.splice(d,1);c=!0;this._debug("Unregistered extension",a);a=e.extension;b(a.unregistered)&&a.unregistered();break}}return c};this.getExtension=function(a){for(var b=0;b<E.length;++b){var c=E[b];if(c.name===a)return c.extension}return null};this.getName=function(){return Oa};
this.getClientId=function(){return U};this.getURL=function(){if(v){var a=v.getURL();if(a||(a=w.urls[v.getType()]))return a}return w.url};this.getTransport=function(){return v};this.getConfiguration=function(){return this._mixin(!0,{},w)};this.getAdvice=function(){return this._mixin(!0,{},D)};this.setTimeout=function(a,b){return O.setTimeout(function(){try{h._debug("Invoking timed function",a),a()}catch(B){h._debug("Exception invoking timed function",a,B)}},b)};this.clearTimeout=function(a){O.clearTimeout(a)};
window.WebSocket&&this.registerTransport("websocket",new sa);this.registerTransport("long-polling",new oa);this.registerTransport("callback-polling",new pa)},Transport:z,RequestTransport:H,LongPollingTransport:oa,CallbackPollingTransport:pa,WebSocketTransport:sa,Utils:q,Z85:{encode:function(f){var d=null;f instanceof ArrayBuffer?d=f:f.buffer instanceof ArrayBuffer?d=f.buffer:Array.isArray(f)&&(d=(new Uint8Array(f)).buffer);if(null==d)throw"Cannot Z85 encode "+f;f=d.byteLength;var b=f%4;b=4-(0===b?
4:b);d=new DataView(d);for(var c="",k=0,e=0;e<f+b;++e){var m=e>=f;k=256*k+(m?0:d.getUint8(e));if(0===(e+1)%4){for(var g=52200625,l=5;0<l;--l){if(!m||l>b)c+=T[Math.floor(k/g)%85];g/=85}k=0}}return c},decode:function(f){var d=f.length%5,b=5-(0===d?5:d);for(d=0;d<b;++d)f+=T[T.length-1];d=f.length;b=new ArrayBuffer(4*d/5-b);for(var c=new DataView(b),k=0,e=0,l=0,g=0;g<d;++g){var q=f.charCodeAt(e++)-32;k=85*k+ha[q];if(0===e%5){for(q=16777216;1<=q;)l<c.byteLength&&c.setUint8(l++,Math.floor(k/q)%256),q/=
256;k=0}}return b}}}});
